[gd_scene format=3 uid="uid://5bwv64i3jmdl"]

[ext_resource type="Script" uid="uid://dcjeykvv2g0oa" path="res://demo_project/UI/demo_project.gd" id="1_22g2r"]
[ext_resource type="PackedScene" uid="uid://bb2n3shtb6wqy" path="res://demo_project/game/game.tscn" id="1_jjin1"]
[ext_resource type="CodeHighlighter" uid="uid://bqthn6yvplu3e" path="res://demo_project/UI/code_highlighter.tres" id="2_bff20"]
[ext_resource type="Script" uid="uid://bvni8uxyvdoju" path="res://demo_project/game/script.gd" id="2_ccxw6"]
[ext_resource type="Resource" uid="uid://56f5vwkxrhb4" path="res://demo_project/demo_scripts/script1.tres" id="3_c5ajx"]
[ext_resource type="Resource" uid="uid://bi8r6s2sp41ef" path="res://demo_project/demo_scripts/script2.tres" id="4_hscad"]
[ext_resource type="Resource" uid="uid://b6xfgyak7l5jx" path="res://demo_project/demo_scripts/script3.tres" id="5_t2o88"]

[sub_resource type="CodeHighlighter" id="CodeHighlighter_22g2r"]
number_color = Color(0.6313726, 1, 0.8784314, 1)
symbol_color = Color(0.67058825, 0.7882353, 1, 1)
function_color = Color(0.34117648, 0.7019608, 1, 1)
member_variable_color = Color(0.7372549, 0.8784314, 1, 1)
keyword_colors = {
"DemoAPI": Color(0.78039217, 1, 0.92941177, 1),
"ModAPI": Color(0.78039217, 1, 0.92941177, 1),
"class_name": Color(1, 0.4392157, 0.52156866, 1),
"extends": Color(1, 0.4392157, 0.52156866, 1),
"func": Color(1, 0.4392157, 0.52156866, 1),
"if": Color(1, 0.54901963, 0.8, 1),
"return": Color(1, 0.4392157, 0.52156866, 1)
}
member_keyword_colors = {
"GameConstants": Color(0.78039217, 1, 0.92941177, 1),
"color": Color(0.7372549, 0.8784314, 1, 1),
"game": Color(0.7372549, 0.8784314, 1, 1),
"shape": Color(0.7372549, 0.8784314, 1, 1),
"x": Color(0.7372549, 0.8784314, 1, 1),
"y": Color(0.7372549, 0.8784314, 1, 1)
}

[sub_resource type="Theme" id="Theme_bff20"]

[node name="DemoProject" type="MarginContainer" unique_id=1856701032 node_paths=PackedStringArray("code_edit", "option_button_examples", "v_box_container_constants", "help", "button_compile", "option_button_functions", "button_run", "mod_api", "scripting_language", "game", "output")]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = ExtResource("1_22g2r")
demo_library = Array[ExtResource("2_ccxw6")]([ExtResource("3_c5ajx"), ExtResource("4_hscad"), ExtResource("5_t2o88")])
code_edit = NodePath("HBoxContainer/HBoxContainer/MainContainer/VBoxContainer/CodeEdit")
option_button_examples = NodePath("HBoxContainer/HBoxContainer/MainContainer/VBoxContainer/OptionButtonExamples")
v_box_container_constants = NodePath("HBoxContainer/HBoxContainer/VBoxContainer2/VBoxContainerConstants")
help = NodePath("HBoxContainer/HBoxContainer/MainContainer/Help")
button_compile = NodePath("HBoxContainer/HBoxContainer/MainContainer/VBoxContainer/HBoxContainer/ButtonCompile")
option_button_functions = NodePath("HBoxContainer/HBoxContainer/MainContainer/VBoxContainer/HBoxContainer/OptionButtonFunctions")
button_run = NodePath("HBoxContainer/HBoxContainer/MainContainer/VBoxContainer/HBoxContainer/ButtonRun")
mod_api = NodePath("HBoxContainer/HBoxContainer/MainContainer/Help/TabContainer/ModApi")
scripting_language = NodePath("HBoxContainer/HBoxContainer/MainContainer/Help/TabContainer/Script Documentation")
game = NodePath("HBoxContainer/VBoxContainer2/Game")
output = NodePath("HBoxContainer/VBoxContainer2/output")

[node name="HBoxContainer" type="HBoxContainer" parent="." unique_id=687394451]
layout_mode = 2

[node name="HBoxContainer" type="HBoxContainer" parent="HBoxContainer" unique_id=738017128]
layout_mode = 2
size_flags_horizontal = 3

[node name="VBoxContainer2" type="VBoxContainer" parent="HBoxContainer/HBoxContainer" unique_id=1348522566]
layout_mode = 2

[node name="VBoxContainerConstants" type="VBoxContainer" parent="HBoxContainer/HBoxContainer/VBoxContainer2" unique_id=771494682]
custom_minimum_size = Vector2(64, 0)
layout_mode = 2
size_flags_vertical = 3

[node name="ButtonHelp" type="Button" parent="HBoxContainer/HBoxContainer/VBoxContainer2" unique_id=1448547299]
custom_minimum_size = Vector2(64, 64)
layout_mode = 2
theme_override_font_sizes/font_size = 32
text = "?"

[node name="MainContainer" type="MarginContainer" parent="HBoxContainer/HBoxContainer" unique_id=375316934]
layout_mode = 2
size_flags_horizontal = 3

[node name="VBoxContainer" type="VBoxContainer" parent="HBoxContainer/HBoxContainer/MainContainer" unique_id=2095169016]
layout_mode = 2
size_flags_horizontal = 3

[node name="HBoxContainer" type="HBoxContainer" parent="HBoxContainer/HBoxContainer/MainContainer/VBoxContainer" unique_id=1955189111]
layout_mode = 2

[node name="ButtonCompile" type="Button" parent="HBoxContainer/HBoxContainer/MainContainer/VBoxContainer/HBoxContainer" unique_id=1593252604]
layout_mode = 2
text = "Compile"

[node name="OptionButtonFunctions" type="OptionButton" parent="HBoxContainer/HBoxContainer/MainContainer/VBoxContainer/HBoxContainer" unique_id=1700548883]
layout_mode = 2
size_flags_horizontal = 3

[node name="ButtonRun" type="Button" parent="HBoxContainer/HBoxContainer/MainContainer/VBoxContainer/HBoxContainer" unique_id=2055207628]
clip_contents = true
custom_minimum_size = Vector2(50, 0)
layout_mode = 2
disabled = true
text = "Run"

[node name="CodeEdit" type="CodeEdit" parent="HBoxContainer/HBoxContainer/MainContainer/VBoxContainer" unique_id=672362188]
layout_mode = 2
size_flags_vertical = 3
text = "func test_draw
reset()
call draw(x=1,y=1)
end func

func draw(x,y)
assign_random(x,y)
end func

func test
reset()
assign_shape(SHAPE_CIRCLE, COLOR_BLUE, 1, 1)
assign_random_shape(COLOR_RED, 2, 3)
assign_random_color(SHAPE_TRIANGLE, 4, 2)
assign_random(0,3)
end func

func test2
	x = 0
	while x < 5
		y = 0
		while y < 4
			assign_random(x,y)
			y = y + 1
		end while
		x = x + 1
	end while
end func

func test3
	x = 0
	while x < 5
		y = 0
		while y < 4
			if shape(x,y) == SHAPE_TRIANGLE
				assign_shape(SHAPE_TRIANGLE,COLOR_RED,x,y)
			end if
			y = y + 1
		end while
		x = x + 1
	end while
end func"
syntax_highlighter = ExtResource("2_bff20")
gutters_draw_line_numbers = true
code_completion_enabled = true

[node name="OptionButtonExamples" type="OptionButton" parent="HBoxContainer/HBoxContainer/MainContainer/VBoxContainer" unique_id=114948057]
layout_mode = 2

[node name="Help" type="MarginContainer" parent="HBoxContainer/HBoxContainer/MainContainer" unique_id=195935649]
layout_mode = 2

[node name="Panel" type="ColorRect" parent="HBoxContainer/HBoxContainer/MainContainer/Help" unique_id=1865665121]
layout_mode = 2
color = Color(0.23633423, 0.23633423, 0.2363342, 1)

[node name="TabContainer" type="TabContainer" parent="HBoxContainer/HBoxContainer/MainContainer/Help" unique_id=672195188]
layout_mode = 2
current_tab = 0

[node name="Overview" type="RichTextLabel" parent="HBoxContainer/HBoxContainer/MainContainer/Help/TabContainer" unique_id=2142981582]
layout_mode = 2
text = "To test out the Mod Scripting FrameworQ, select one of the example scripts from the bottom and then hit 'Compile'. After successful compilation, select a function at the top and press 'Run' to execute that function. Changes to the code always need to be compiled, before they can be used.

On the top right side is the game area, that the demoAPI has access to. It allows a script to set the shape and color of a grid cell, as well as read the shape and color. Shapes and colors are keywords added to the demoAPI, and can be autofilled in the script by clicking the buttons on the left.
The full code of the demoAPI can be found in the 'DemoAPI\" tab for reference.

On the bottom right is the debug output that will give feedback on errors in the script.

Pressing the '?' at the bottom left will close this documentation."
metadata/_tab_index = 0

[node name="ModApi" type="CodeEdit" parent="HBoxContainer/HBoxContainer/MainContainer/Help/TabContainer" unique_id=2055950620]
visible = false
layout_mode = 2
text = "extends ModAPI
class_name DemoAPI

var game: Game

func assign_shape(shape, color, x, y) -> void:
	if shape is int:
		if shape < 0 or shape > GameConstants.shape.size():
			return
	if color is int:
		if color < 0 or color > GameConstants.color.size():
			return
	if not (str(x).is_valid_int() and str(x).is_valid_int()):
		return
	game.assign_shape(shape, color, int(x), int(y))

func assign_random_shape(color, x, y) -> void:
	if color is int:
		if color < 0 or color > GameConstants.color.size():
			return
	if not (str(x).is_valid_int() and str(x).is_valid_int()):
		return
	game.assign_shape(randi_range(0, GameConstants.shape.size()-1), color, int(x), int(y))

func assign_random_color(shape, x, y) -> void:
	if shape is int:
		if shape < 0 or shape > GameConstants.shape.size():
			return
	if not (str(x).is_valid_int() and str(x).is_valid_int()):
		return
	game.assign_shape(shape, randi_range(0, GameConstants.color.size()-1), int(x), int(y))

func assign_random(x, y) -> void:
	if not (str(x).is_valid_int() and str(x).is_valid_int()):
		return
	game.assign_shape(randi_range(0, GameConstants.shape.size()-1), randi_range(0, GameConstants.color.size()-1), int(x), int(y))

func get_shape(x, y) -> int:
	if not (str(x).is_valid_int() and str(x).is_valid_int()):
		return GameConstants.shape.SQUARE
	return game.get_shape(int(x),int(y))

func get_color(x, y) -> int:
	if not (str(x).is_valid_int() and str(x).is_valid_int()):
		return GameConstants.color.WHITE
	return game.get_color(int(x),int(y))


func reset() -> void:
	game.reset()
"
editable = false
syntax_highlighter = SubResource("CodeHighlighter_22g2r")
metadata/_tab_index = 1

[node name="Script Documentation" type="RichTextLabel" parent="HBoxContainer/HBoxContainer/MainContainer/Help/TabContainer" unique_id=1852999323]
visible = false
layout_mode = 2
theme = SubResource("Theme_bff20")
bbcode_enabled = true
text = "Scripts are stored and read as plain text, so they can be easily written and edited in any text editor.

[b]Functions[/b]
Every function has to start with [color=#ff7085]func[/color] and end with [color=#ff7085]end func[/color], and it has to have a valid name, starting with a letter (a-zA-Z) and containing only letters, numbers and '_'(a-zA-z0-9_).

Example:
	[color=#ff7085]func[/color] test_1
	[color=#ff7085]end func[/color]

[i]Parameters[/i]
Parameters are optional. If a function takes parameters, they have to be listed in brackets. Optionally, a default value can be assigned. The order of parameters does not matter.

Example:
	[color=#ff7085]func[/color] test_2(x,y=3)
	[color=#ff7085]end func[/color]

===============================================
[b]Variables[/b]
Variables are dynamically typed. Catching any type mismatch for API calls must happen inside the ModAPI. A variable is initialized by assigning a value to it. There are 3 levels of variables.
[ol]
API variables are readonly for the script and allows the modAPI to pass environment variables to the script. A ModAPI-function should be implemented to explicitly give scripts access to API variables.
Global variables can be initiated in the script body outside of any function. If an API variable of the same name is present, the global variable shadows it.
Local variables need to be initiated inside a function or as its parameters. If a global or API variable of the same name is present, the local variable shadows them.
[/ol]
Assignments are evaluated as expressions, which allows for function calls directly inside an assignment.

Example:
	ticks_left = 0
	[color=#ff7085]func[/color] test_3
		x = 7
	[color=#ff7085]end func[/color]

===============================================
[b]Conditionals[/b]
Conditional blocks start with the [color=#ff8ccc]if[/color] keyword and end with [color=#ff8ccc]end if[/color]. The condition follows the [color=#ff8ccc]if[/color] keyword with a space between them. An optional [color=#ff8ccc]else[/color]

Example:
	[color=#ff7085]func[/color] test_4
		[color=#ff8ccc]if[/color] player_health > 99
			attack = 10
		[color=#ff8ccc]else[/color]
			attack = 5
		[color=#ff8ccc]if[/color]
	[color=#ff7085]end func[/color]
"
metadata/_tab_index = 2

[node name="VBoxContainer2" type="VBoxContainer" parent="HBoxContainer" unique_id=482146973]
layout_mode = 2

[node name="Game" parent="HBoxContainer/VBoxContainer2" unique_id=753947429 instance=ExtResource("1_jjin1")]
layout_mode = 2

[node name="output" type="RichTextLabel" parent="HBoxContainer/VBoxContainer2" unique_id=1795031821]
layout_mode = 2
size_flags_vertical = 3
bbcode_enabled = true

[connection signal="pressed" from="HBoxContainer/HBoxContainer/VBoxContainer2/ButtonHelp" to="." method="_on_button_help_pressed"]
[connection signal="pressed" from="HBoxContainer/HBoxContainer/MainContainer/VBoxContainer/HBoxContainer/ButtonCompile" to="." method="_on_button_compile_pressed"]
[connection signal="pressed" from="HBoxContainer/HBoxContainer/MainContainer/VBoxContainer/HBoxContainer/ButtonRun" to="." method="_on_button_run_pressed"]
[connection signal="item_selected" from="HBoxContainer/HBoxContainer/MainContainer/VBoxContainer/OptionButtonExamples" to="." method="_on_option_button_examples_item_selected"]
